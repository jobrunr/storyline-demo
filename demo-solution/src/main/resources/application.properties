management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
spring.thymeleaf.cache=false

server.port=8080
spring.application.name=storyline-demo

spring.datasource.url=jdbc:postgresql://localhost:5432/demo
spring.datasource.username=postgres
spring.datasource.password=password

spring.sql.init.mode=always

jobrunr.dashboard.enabled=true
# optional: showcase the embedded dashboard feature
jobrunr.dashboard.type=embedded
jobrunr.background-job-server.enabled=true
jobrunr.background-job-server.worker-count=4

# step 9: this server processes national payments only, run a second one for international ones
jobrunr.background-job-server.tags=national

# step 7: payments should have prio over monthly report generation
jobrunr.queues.names=high-prio,low-prio
jobrunr.queues.default-queue-name=low-prio

# step 8a: enterprise customers should have prio for payments
jobrunr.jobs.dynamic-queue.round-robin.label-prefix=customer:
jobrunr.jobs.dynamic-queue.round-robin.title=Customers

# step 8b: weighted round-robin to avoid starvation on pro customers
#jobrunr.jobs.dynamic-queue.weighted-round-robin.label-prefix=customer:
#jobrunr.jobs.dynamic-queue.weighted-round-robin.title=Customers
#jobrunr.jobs.dynamic-queue.weighted-round-robin.queues.ENTERPRISE=5

# step 10: add a rate limiter
jobrunr.jobs.rate-limiter.concurrent-job-rate-limiter.external=3

# step 11: observability support; add micrometer exposure
jobrunr.jobs.metrics.enabled=true
jobrunr.jobs.metrics.micrometer-timers.enabled=true

# step 12: observability: tracing
management.tracing.sampling.probability=1.0
management.otlp.tracing.endpoint=http://localhost:4318/v1/traces
jobrunr.jobs.metrics.otel-observability.enabled=true
jobrunr.dashboard.integrations.observability.jaeger.root-url=http://localhost:16686/
